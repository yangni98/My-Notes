# javaweb购物车实现思路

1.用cookie实现购物车；

2.用session实现购物车；

3.用cookie和数据库(购物车信息持久化)实现购物车；

分析一下这三种方法的优缺点：

1.单纯有cookie实现购物车，这样的购物车不是很理想，设想一下，如果客户端的浏览器把cookie给禁用了，

这种方法就会在这里流产…

2.session中保存购物车的信息，这个只是在一个会话中可用，如果用户没有登录，或者说登录了以后，添加购物车，在关闭浏览器

或者登出后，之前所添加的购物车通通都流产啦…

#### 3.我这里要说就是这种方法;

### 主要的流程：

A.用户登录前的数据流：用户在没有登录系统的时候，对喜欢的商品进行添加购物车，那么这个时候，我们可以把购物车信息保存

到cookie中，这里会涉及到cookie的添加，修改操作；也即如果之前在cookie中不存对应的cookie，则就对cookie进行添加操作。

如果在cookie中存在对应的cookie，那么，这时候，就要对cookie进行修改操作了(这里涉及到用户对同一个商品进行多次添加购物车的情况)。

B.用户登录后的数据流：用户在登录后，系统首先做的第一件事就是去获取对应的cookies，如果存在相关的购物车cookies，那么就对该购物车

信息进行相应用户User的持久化操作，要么添加，要么修改。(添加操作:该用户所对应的购物车如果没有相应的信息进行添加操作；修改操作：类似的，

如果存在对应用户的购物车信息，就进行修改操作)。用户登录后，也可以进行购物车的添加操作，不过，这里不是添加到cookie中，而是直接持久化到

数据库中。注：用户登录后的数据都是和数据库打交道。
————————————————

//1.根据商品SKU ID查询SKU商品信息
//2.获取商家ID    
//3.根据商家ID判断购物车列表中是否存在该商家的购物车   
//4.如果购物车列表中不存在该商家的购物车
//4.1 新建购物车对象
//4.2 将新建的购物车对象添加到购物车列表   
//5.如果购物车列表中存在该商家的购物车   
  // 查询购物车明细列表中是否存在该商品
//5.1. 如果没有，新增购物车明细   
//5.2. 如果有，在原购物车明细上添加数量，更改金额









## 免登录功能实现

/*
* 10天免登录操作
*   第一部分业务：在登录的时候操作，login.do
*   1.用户登录，勾选10天免登录
*       i.给复选框一个标识，将标识传递到后台
*       ii.后台接收到标识后，开始进行免登录操作
*   2.将用户名和密码存入cookie中(传统项目可以，金融/电商不允许这样操作)
*     安全问题？
*       i.拦截器会拦截其他请求，只放行了登录请求和跳转到登录页面的请求
*       ii.由于在我们输入密码以后，会对密码进行MD5加密操作，
*           故存入cookie中的数据都是加密后的数据，即使加密后的数据泄漏，也无法登录，
*           因为在登录时会对密码再次加密，二次加密后的密码，与数据库中的密码无法对应
*   3.设置cookie的一些属性：
*       i.cookie过期时间：60*60*24*10  10天
*       ii.cookie的存放路径：/ 根目录下，保证在任意路径下都能访问到cookie中的数据
*
*   第二部分业务：对跳转到登录页面的请求进行操作，toLogin.do
*   4.获取cookie中的用户名和密码
*   5.自动进行登录
*       调用service.login()方法进行登录
*   6.将自动登录后的用户存入session中
*
*/



# SSM框架下Shiro免密登录

在做微信授权登陆的时候，由于使用shiro框架进行认证登陆，没有认证授权无法建立会话。
数据库中的密码经过md5加密，通过openid查询出账号密码也无法进行授权登陆，所以需要实现Shiro免密授权登陆功能，以防后续踩坑。

##### 自定义token，加入免密标识符，在进行授权时判断是密码登陆或无密码登陆，自定义密码认证方法，即写一个方法继承HashedCredentialsMatcher，重写其中的doCredentialsMatch，将其中的token改写为自定义的token，最后将自己写的密码认证方法注入shiro



